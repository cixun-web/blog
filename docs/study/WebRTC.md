# WebRTC

## 概述

WebRTC可以为应用添加基于开放标准运行的实时通信功能。它支持在对等设备之间发送视频、语音和通用数据，使开发者能够构建强大的语音和视频通信解决方案。

### 应用场景

视频会议、在线教育、远程医疗、社交应用、互动直播、远程监控等。

## 技术方案

| 技术方案 | 是否属于（主播 ---> 服务端 ---> 观众） | 是否适合大规模观众 | 延迟 |
| -- | --- | -- | -- |
| HLS + hls.js | 是 | 是 | 3-5 秒 |
| HTTP-FLV + flv.js | 是 | 是 | 1-3 秒 |
| WebRTC + SFU | 是 | 是 | <1 秒 |
| 第三方云平台 | 是 | 是 | 取决于使用方式 |
| WebRTC P2P | 否 | 否 | <1 秒 |
| WebSocket + 自定义 | 否 | 需自研 | <1 秒 |

## 网页端实时直播方案

主播 ---> 服务端（推流）
服务端 ---> 观众（拉流）

以 HLS + hls.js 举例，步骤如下

1. 利用OBS、FFmpeg等工具，实现主播端推流(RTMP协议)
2. 服务端（基于RTMP协议的直播服务器，有：SRS、nginx-rtmp等）
3, 服务端对RTMP流进行转换，转为HLS(.m3u8+ts)
4, 观众端用<video>/hls.js拉取.m3u8播放

> 注1：RTMP实时消息协议，一种将视频/音频数据从主播端推送到服务器的协议。
> 注2：浏览器不能直接播放 RTMP 流，所以通常会转协议为浏览器友好的格式。
> 注3：使用HTTP下载.ts片段、websocket、WebRTC连接(SDP+ICE)。

### WebRTC 特点

WebRTC 可以实现在浏览器里直接推流，而RTMP 协议需要底层 TCP 套接字连接，浏览器不能直接访问裸 TCP Socket。浏览器不能直接推 RTMP，只能通过 WebRTC / WebSocket 等中间层间接实现推流。

WebRTC 是一种使 Web 应用程序和站点能够捕获和选择性流式传输音频或视频媒体，以及在浏览器之间交换任意数据的而无需中间件的技术。WebRTC 的一系列标准使得在不需要用户安装插件或任何其他第三方软件的情况下，可以实现点对点数据共享和电话会议。

## WebRTC P2P

### 信任服务器

信任服务器，可以使用 socket.io 库

### SDP媒体协商

SDP 是一个描述多媒体连接内容的协议，例如分辨率，格式，编码，加密算法等。所以在数据传输时两端都能够理解彼此的数据。本质上，这些描述内容的元数据并不是媒体流本身。

### ICE Candidate 网络协商

网络协商是用于在不同设备之间寻找可用的网络路径，并选择最佳路径进行通信。

主播端发送信息：onicecandidate
观众端收到信息：addlceCandidate
观众端发送信息：onicecandidate
主播端收到信息：addlceCandidate

[peerjs]('peerjs.com')
